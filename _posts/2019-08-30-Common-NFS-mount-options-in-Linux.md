---
layout: post
title: Linux中常见的NFS挂载选项
category: 计算机
tags: [计算机, 软件]
---


----------

## Linux中常见的NFS挂载选项
在客户机上挂载NFS挂载点时，了解使用的参数非常重要。如果您正面临NFS挂载点的性能问题或功能问题，那么了解它们尤其重要。下面是挂载NFS挂载点时使用的选项列表，如下面的语法所示。

```
# mount -t nfs -o [options] remote:/nfs /mount
```

### rw (读/写) / ro (只读)

- 对需要修改数据的用户使用rw。由于你挂载一个读/写目录，NFS服务器必须输出它的读/写特性。
- 当你不希望用户改变数据时，请使用ro。从多个服务器自动挂载的目录应该是只读的，以便在所有服务器上保持版本相同。
- 默认为rw。

### suid / nosuid

- 指定suid，如果你想允许挂载的程序有setuid权限运行与他们的所有者的权限，无论谁启动他们。如果一个具有setuid权限的程序由root拥有，那么它将以root权限运行，而不管谁启动它。
- 指定nosuid，以保护您的系统不受setuid程序的影响，这些程序可能以root身份运行，并损坏您的系统。
- 默认值是suid。

### hard / soft

- 指定用户是否将写入已挂载的目录或运行其中的程序。当NFS试图访问硬挂载目录时，它会一直尝试，直到成功或有人打断它的尝试。如果服务器宕机，使用挂载目录的任何进程都会挂起，直到服务器恢复正常，然后继续处理，不会出现错误。可中断的硬挂载可以用CTRL-C或kill中断(稍后请参阅intr选项)。
- 指定软如果服务器是不可靠的，你想要防止系统挂起时，服务器是关闭。当NFS试图访问软挂载目录时，它会放弃，并在尝试retrans多次之后返回错误消息(稍后请参阅retrans选项)。如果服务器宕机，使用挂载目录的任何进程都将返回错误。
- 默认值是hard。

### intr / nointr

- 如果用户不太可能通过手动中断NFS请求而损坏关键数据，则指定intr。如果硬挂载是可中断的，用户可以按[CTRL]-C或发出kill命令来中断NFS挂载，NFS挂载由于服务器宕机而无限期挂载。
- 指定nointr，如果用户可能通过手动中断NFS请求而损坏关键数据，您宁愿在服务器宕机时挂起系统，也不愿冒客户机和服务器之间数据丢失的风险。
- 默认值为intr。


### fg (前景) / bg (背景)

- 为客户端机器引导或正确操作所需的目录指定fg。如果前台挂载失败，将在前台重试它，直到成功或中断。所有自动加载的目录都安装在前台;不能使用自动挂载目录指定bg选项。
- 指定bg用于安装客户端不需要引导或正确操作的目录。失败的后台挂载将在后台重新尝试，从而允许挂载进程认为挂载已完成并继续进行下一个挂载。如果您将两台机器配置为彼此挂载目录，则将其中一台机器上的挂载配置为后台挂载。这样，如果两个系统都尝试同时启动，它们就不会陷入死锁，每个系统都等待从另一个系统挂载目录。bg选项不能与自动加载的目录一起使用。
- 默认值是fg。

### devs / nodevs

- 如果你是安装设备文件从服务器其设备文件将正确工作在客户端，请使用devs选项。devs选项允许使用NFS挂载的设备文件从NFS客户机读写设备。如果您的所有系统都配置类似，那么它对于维护一组标准的、集中的设备文件非常有用。
- 如果从服务器上挂载的设备文件不能正确地用于读取和写入NFS客户机上的设备，请指定nodevs选项。如果NFS客户机上的进程试图读取或写入NFS安装的设备文件，nodevs选项将生成一个错误。
- 默认值是devs。

### timeo=n

- NFS请求的超时，以十分之一秒为单位(读取和写入挂载目录的请求)。如果NFS请求超时，这个超时值将加倍，请求将重新传输。在通过retrans选项指定的次数重新传输NFS请求之后(参见下面)，软挂载返回一个错误，而硬挂载重试请求。最大时间o值是30(3秒)。
- 如果您看到多个服务器在几分钟内没有响应消息，请尝试将timeo值加倍。这可能是因为您正在跨网关挂载目录，因为您的服务器很慢，或者因为您的网络忙于处理繁重的流量。
- 默认值为timeo=7

### retrans=n

- NFS请求(对挂载目录的读或写请求)超时后重新传输的次数。如果在n次重传之后请求没有成功，软挂载将返回一个错误，而硬挂载将重试请求。
- 增加从服务器软挂载的目录的retrans值，该目录频繁、短时间停机。这使服务器有足够的时间恢复，因此软挂载不会返回错误。
- 默认值是retrans=4。

### retry=n

- NFS客户机在第一次尝试失败后尝试挂载目录的次数。如果指定intr，可以在n次重试之前中断挂载。但是，如果指定nointr，则必须等待n次重试，直到挂载成功，或者重新引导系统。
- 如果挂载失败是因为您的服务器非常忙，增加重试值可以修复问题。
- 默认值是retry=1。

### rsize=n

- NFS客户机在单个读取请求中从NFS服务器请求的字节数。
- 如果在客户端和服务器之间丢弃数据包，将rsize减小到4096或2048。要查明是否正在删除数据包，请在HP-UX提示符下发出“nfsstat -rc”命令。如果这个命令返回的超时和retrans值很高，但是badxid号接近于零，那么数据包将被丢弃在网络中的某个位置。
- 默认值为rsize=8192。

### wsize=n

- NFS客户机在单个写请求中向NFS服务器发送的字节数。
- 如果在客户端和服务器之间丢弃数据包，将wsize减小到4096或2048。要查明是否正在删除数据包，请在HP-UX提示符下发出“nfsstat -rc”命令。如果这个命令返回的超时和retrans值很高，但是badxid号接近于零，那么数据包将被丢弃在网络中的某个位置。
- 默认值是wsize=8192。

### O (重叠挂载)

- 允许将文件系统挂载在现有挂载点上，使基础文件系统不可访问。如果尝试在没有-O选项的情况下将文件系统挂载到现有挂载点上，挂载将失败，错误设备将处于繁忙状态。
- 注意：使用-O挂载选项会使系统处于混乱状态。O选项允许您在NFS挂载点下隐藏本地数据，而不会收到任何警告。在常规系统备份期间，NFS挂载点下隐藏的本地数据将不会得到备份。
- 在HP-UX上，-O选项仅对nfs挂载的文件系统有效。因此，如果指定-O选项，还必须为mount命令指定-F nfs选项，或者在/etc/fstab文件中指定nfs文件系统类型。
- 没有为该参数指定默认值。

### remount

- 如果文件系统是只读挂载的，此选项将重新挂载它的读/写。这允许您将访问权限从只读更改为读/写，而不必强制每个人离开挂载的目录或杀死使用该目录的所有进程。
- 此参数未指定默认值。

### noac

- 如果指定，此选项将防止NFS客户机缓存挂载目录的属性。
- 为许多NFS客户机经常使用的目录指定noac。noac选项确保服务器上的文件和目录属性是最新的，因为客户机上不缓存任何更改。但是，如果使用相同NFS服务器的许多NFS客户机都禁用了属性缓存，那么服务器可能会因属性请求和更新而过载。还可以使用actimeo选项将所有缓存超时设置为少量秒，比如1秒或3秒。
- 如果指定noac，则不要指定其他缓存选项。
- 此参数未指定默认值。

### nocto

- 如果指定，此选项将在打开文件时禁用新属性。
- 指定一个从未更改的文件或目录的nocto，以减少网络上的负载。
- 此参数未指定默认值。

### acdirmax=n

- NFS客户机上缓存目录属性的最大秒数。当这个超时期间过期时，客户机刷新它的属性缓存，如果属性已经更改，客户机将它们发送到NFS服务器。
- 对于很少更改或只有一个用户拥有和修改的目录，比如用户的主目录，可以通过设置acdirmax=120或更高来减少网络上的负载。
- 默认值是acdirmax=60。

### acdirmin=n

- NFS客户机上缓存目录属性的最小秒数。如果在此超时过期之前修改了目录，超时时间将延长acdirmin秒。
- 对于很少更改或仅由一个用户拥有和修改的目录，比如用户的主目录，可以通过设置acdirmin=60或更高来减少网络上的负载。
- 默认值是acdirmin=30。

### acregmax=n

- NFS客户机上缓存文件属性的最大秒数。当这个超时期间过期时，客户机刷新它的属性缓存，如果属性已经更改，客户机将它们发送到NFS服务器。
- 对于很少更改或只有一个用户拥有和修改的文件，比如用户的主目录中的文件，可以通过设置acregmax=120或更高来减少网络上的负载。
- 默认值是acregmax=60。

### actimeo=n

- 将actimeo设置为n秒相当于将acdirmax、acdirmin、acregmax和acregmin设置为n秒。
- 将actimeo=1或actimeo=3设置为许多NFS客户机经常使用和修改的目录。这确保文件和目录属性保持合理的最新，即使它们经常从不同的客户端位置更改。
- 设置actimeo=120或更高，用于一个很少或从不更改的目录。
- 如果设置actimeo值，不要设置acdirmax、acdirmin、acregmax或acregmin值。
- 此参数未设置默认值。

### vers=n

- 要使用的NFS协议的版本。默认情况下，本地NFS客户机将尝试使用NFS version 3挂载文件系统。如果NFS服务器不支持版本3，则将使用版本2挂载文件系统。
- 如果您知道NFS服务器不支持版本3，那么指定vers=2，您将在挂载期间节省时间，因为客户端在使用版本2之前不会尝试使用版本3。
- 参数的默认值是vers=3。

### grpid

- 强制挂载文件系统中新创建的文件继承父目录的组ID。
- 默认情况下，新创建的文件继承调用进程的有效组ID，除非在父目录上设置GID位。如果设置了GID位，新文件将继承父目录的组ID。
- 此参数未设置默认值。